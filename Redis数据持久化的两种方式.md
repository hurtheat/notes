一、AOF(append only file)

###### 1.AOF的概念

    AOF全称Append Only File，只追加文件方式。当Redis增删改查数据后，将其命令写入一个日志中，如Redis遭遇宕机，可以根据这个日志文件进行数据的恢复，达到数据持久化的目的。

###### 2.AOF的性质--写后日志

    AOF是一个写后日志，也就是说当数据在Redis操作后，如果成功，则将这些操作数据的命令追加的这个日志文件中。

    写后日志的原因：

        1.Redis是单线程，如果先写追加后操作数据，会阻塞数据的操作

        2.redis追加日志时不会进行语法校验，如果先追加不能保证追加进日志的命令的正确。

###### 3.AOF存在的问题

   1. 当操作数据成功后，准备将数据追加到日志中时，此时Redis宕机，那么这样操作这部分数据的命令没有追加进入日志，下次恢复的时候就无法找到这部分数据，造成数据不一致。



    2.当数据恢复的时候，Redis必须一条条读取AOF日志中的命令，逐条恢复，如果数据量大，恢复的时间较长。



    3.AOF日志最终是存在于磁盘中的，意味这这些日志都要写回磁盘中，写回的这一过程想到较慢（物理磁盘），可能会阻塞下一次的主线程的数据操作，造成Redis响应变慢。



    4 .既然AOF是以日志文件的形式存储命令，那么如果数据过大，文件也会很大，造成存储空间的压力（一般不会，只是潜在问题）。

###### 4.写回策略

    针对上述日志没有记录到日志文件中，Redis宕机以及写回磁盘数据阻塞主线程的下一次操作的问题，可以发现其实都是日志写回磁盘的时机问题。
如果写回太频繁，对于Redis的性能有影响，不够频繁，造成数据不一致的几率又更高了。
因此，Redis提供了三种常用的写回策略

    1.Always：同步写回，每个命令写完，立即同步到磁盘
    2.EverySec:每隔一秒写回磁盘一次
    3.NO:Redis不控制写回时间，又操作系统决定

###### 5.AOF的重写机制


